<!DOCTYPE html>
<html lang="en" class="h-full bg-gray-100 dark:bg-gray-900">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tibana</title>
  <!-- Tailwind CSS with Typography plugin -->
  <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="h-full flex flex-col text-gray-800 dark:text-gray-100">
  <!-- HEADER -->
  <header class="bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 text-white shadow">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <!-- lightning-bolt icon -->
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none"
             viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path d="M7 2l6 1-5 9 6 1-6 9 1-11-6-1 5-9z" />
        </svg>
        <h1 class="text-2xl sm:text-3xl font-extrabold tracking-tight">
          TPOT Alerts
        </h1>
      </div>
      <!-- ACTION BUTTONS -->
      <div class="space-x-2 flex items-center">
        <form action="{{ url_for('run_fetch') }}" method="post" class="inline">
          <button type="submit"
                  class="px-4 py-2 rounded font-semibold bg-blue-600 hover:bg-blue-700 text-white">
            Fetch &amp; Write
          </button>
        </form>
        <form action="{{ url_for('run_text') }}" method="post" class="inline">
          <button type="submit"
                  class="px-4 py-2 rounded font-semibold bg-green-600 hover:bg-green-700 text-white">
            Export to Text
          </button>
        </form>
        <form action="{{ url_for('run_misp') }}" method="post" class="inline">
          <button type="submit"
                  class="px-4 py-2 rounded font-semibold bg-blue-600 hover:bg-blue-700 text-white">
            Export to MISP
          </button>
        </form>
        <!-- Dark-mode toggle -->
        <button id="modeToggle" class="ml-4 p-2 rounded hover:bg-white/10 transition">
          <svg id="sunIcon" class="h-6 w-6 hidden" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M12 2v2m6.364 1.636l-1.414 1.414M20 12h-2M18.364 18.364l-1.414-1.414
                     M12 20v-2M5.636 18.364l1.414-1.414M4 12H2m2.636-7.364l1.414 1.414"/>
          </svg>
          <svg id="moonIcon" class="h-6 w-6" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M21 12.79A9 9 0 1111.21 3a7 7 0 009.79 9.79z"/>
          </svg>
        </button>
      </div>
    </div>
  </header>

  <!-- MAIN CONTENT -->
  <main class="flex-1 overflow-auto p-6 space-y-10 max-w-7xl mx-auto">
    <!-- CHART CARD -->
    <section class="card">
      <h2 class="text-lg font-semibold mb-4">Alerts Over Time</h2>
      <canvas id="timeChart" class="w-full h-64"></canvas>
      <div id="chartLoader" class="flex justify-center py-6">
        <svg class="animate-spin h-6 w-6 text-blue-600 dark:text-blue-300" xmlns="http://www.w3.org/2000/svg"
             fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path d="M12 4v2m6.364 1.636l-1.414 1.414M20 12h-2M18.364 18.364l-1.414-1.414
                   M12 20v-2M5.636 18.364l1.414-1.414M4 12H2m2.636-7.364l1.414 1.414"/>
        </svg>
      </div>
    </section>

    <!-- TABLE CARD -->
    <section class="card">
      <h2 class="text-lg font-semibold mb-4">Recent Alerts</h2>
      <div class="overflow-auto">
        <table class="min-w-full table-zebra text-sm">
          <thead class="sticky top-0 bg-gray-100 dark:bg-gray-800">
            <tr>
              <th class="px-6 py-3 text-left font-medium">Type</th>
              <th class="px-6 py-3 text-left font-medium">Source IP</th>
              <th class="px-6 py-3 text-left font-medium">Sensor</th>
              <th class="px-6 py-3 text-left font-medium">Time</th>
            </tr>
          </thead>
          <tbody id="alertsTable"></tbody>
        </table>
      </div>
    </section>
  </main>

  <!-- Charts init -->
  <script src="{{ url_for('static', filename='js/charts.js') }}"></script>
  <!-- Dark-mode toggle script -->
  <script>
    document.getElementById('modeToggle').onclick = () =>
      document.documentElement.classList.toggle('dark');
  </script>
</body>
</html>
